

<div class="tabPage">
    <div class="address_header">
        <table id="headercontrol" style="background-color: #ffffff">
            <tr>
                <td><b>Категорія контрагента</b></td>
                <td><?echo $CategoryOfCustomer?></td>
            </tr>
            <tr>
                <td><b>Назва контрагента</b></td>
                <td><?echo $object->name?></td>
            </tr>
            <tr>
                <td><b>Форма правління</b></td>
                <td><?echo $FormOfGoverment?></td>
            </tr>
        </table>
    </div>

    <form id="addaddress" action="<?echo $action_url?>" method="post">
        <input id="rowid" name="rowid" type="hidden" value="<?echo $soc_address->rowid?>">
        <input id="url" name="url" type="hidden" value="<?echo $url?>">
        <input id="action" name="action" type="hidden" value="<?echo $action?>">
        <input id="mainmenu" name="mainmenu" type="hidden" value="<?echo GETPOST('mainmenu', 'alpha')?>">
        <input id="idmenu" name="idmenu" type="hidden" value="<?echo GETPOST('idmenu', 'alpha')?>">
        <input id="socid" name="socid" type="hidden" value="<?echo $socid?>">
        <input id="SendPost" name="SendPost" type="hidden" value="<? if($action == 'add'){echo 1;}else{echo $soc_address->SendPost;}?>">
        <input id="SendEmail" name="SendEmail" type="hidden" value="<?if($action == 'add'){ echo 1;} else{ echo $soc_address->SendEmail;}?>">
        <table class="border" width="100%">
            <tr>
                <td>
                <!--<td class="<?if($action == 'error' && empty($soc_address->whom)){echo 'fielderror';}else{echo 'fieldrequired';}?>">-->
                    <?echo $langs->trans('Whom')?>
                </td>
                <td>
                    <input id="whom" class="ui-autocomplete-input" type="text" autofocus="autofocus" value="<?echo $soc_address->whom?>" name="whom" maxlength="128" size="60" autocomplete="off">
                </td>
            </tr>
            <tr>
                <td>
                <!--<td class="<?if($action == 'error' && empty($soc_address->kindaddress)){echo 'fielderror';}else{echo 'fieldrequired';}?>">-->
                    <?echo $langs->trans('KindAddress')?>
                </td>
                <td>
                    <?echo $soc_address->selectKindAddress('kindaddress', $soc_address->kindaddress)?>
                </td>
            </tr>
            <tr>
                <td>
                <!--<td class="<?if($action == 'error' && empty($soc_address->Zip)){echo 'fielderror';}else{echo 'fieldrequired';}?>">-->
                    <?echo $langs->trans('Zip')?>
                </td>
                <td>
                    <input id="zip" class="ui-autocomplete-input" type="text" autofocus="autofocus" value="<?echo $soc_address->Zip?>" name="zip" maxlength="5" size="60" autocomplete="off">
                </td>
            </tr>
            <tr>
                <td>
                <!--<td class="<?if($action == 'error' && $soc_address->country_id == 0){echo 'fielderror';}else{echo 'fieldrequired';}?>">-->
                    <?echo $langs->trans('Country')?>
                </td>
                <td>
                    <?echo $form->select_country(GETPOST('country_id')!=''?GETPOST('country_id'):'UA')?>
                </td>
            </tr>
            <tr>
                <td>
                <!--<td class="<?if($action == 'error' && $soc_address->state_id == 0){echo 'fielderror';}else{echo 'fieldrequired';}?>">-->
                    <?echo $langs->trans('State')?>
                </td>
                <td>
                    <?echo $formcompany->select_state($soc_address->state_id, $soc_address->country_id)?>
                </td>
            </tr>
            <tr>
                <!--<td class="<?if($action == 'error' && $soc_address->region_id == 0){echo 'fielderror';}else{echo 'fieldrequired';}?>">-->
                <td>
                    <?echo $langs->trans('Areas')?>
                </td>
                <td>
                    <?echo $formcompany->select_region($soc_address->state_id,'region_id', $soc_address->region_id)?>
                </td>
            </tr>
            <tr>
                <td>
                <!--<td class="<?if($action == 'error' && $soc_address->kindlocality_id == 0){echo 'fielderror';}else{echo 'fieldrequired';}?>">-->
                    <?echo $langs->trans('KindOfLocality')?>
                </td>
                <td>
                    <?echo $soc_address->selectKindLocality('kindlocality_id', $soc_address->kindlocality_id)?>
                </td>
            </tr>
            <tr>
                <td>
                <!--<td class="<?if($action == 'error' && empty($soc_address->location)){echo 'fielderror';}else{echo 'fieldrequired';}?>">-->
                    <?echo $langs->trans('Location')?>
                </td>
                <td>
                    <input id="location" class="ui-autocomplete-input" type="text" autofocus="autofocus" value="<?echo $soc_address->location?>" name="location" maxlength="55" size="60" autocomplete="off">
                </td>
            </tr>
            <tr>
                <td>
                <!--<td class="<?if($action == 'error' && $soc_address->kindlocality_id == 0){echo 'fielderror';}else{echo 'fieldrequired';}?>">-->
                    <?echo $langs->trans('KindOfStreet')?>
                </td>
                <td>
                    <?echo $soc_address->selectKindStreet('kindofstreet_id', $soc_address->kindofstreet_id)?>
                </td>
            </tr>
            <tr>
                <td>
                <!--<td class="<?if($action == 'error' && empty($soc_address->street_name)){echo 'fielderror';}else{echo 'fieldrequired';}?>">-->
                    <?echo $langs->trans('Street')?>
                </td>
                <td>
                    <input id="street_name" class="ui-autocomplete-input" type="text" autofocus="autofocus" value="<?echo $soc_address->street_name?>" name="street_name" maxlength="55" size="60" autocomplete="off">
                </td>
            </tr>
            <tr>
                <td>
                <!--<td class="<?if($action == 'error' && empty($soc_address->NumberOfHouse)){echo 'fielderror';}else{echo 'fieldrequired';}?>">-->
                    <?echo $langs->trans('NumberOfHouse')?>
                </td>
                <td>
                    <input id="numberofhouse" class="ui-autocomplete-input" type="text" autofocus="autofocus" value="<?echo $soc_address->NumberOfHouse?>" name="numberofhouse" maxlength="10" size="60" autocomplete="off">
                </td>
            </tr>
            <tr>
                <td>
                <!--<td class="<?if($action == 'error' && $soc_address->kindoffice_id == 0){echo 'fielderror';}else{echo 'fieldrequired';}?>">-->
                    <?echo $langs->trans('KindOfOffice')?>
                </td>
                <td>
                    <?echo $soc_address->selectKindOffice('kindoffice_id', $soc_address->kindoffice_id)?>
                </td>
            </tr>
            <tr>
                <td>
                <!--<td class="<?if($action == 'error' && empty($soc_address->NumberOfOffice)){echo 'fielderror';}else{echo 'fieldrequired';}?>">-->
                    <?echo $langs->trans('NumberOfOffice')?>
                </td>
                <td>
                    <input id="numberofoffice" class="ui-autocomplete-input" type="text" autofocus="autofocus" value="<?echo $soc_address->NumberOfOffice?>" name="numberofoffice" maxlength="10" size="60" autocomplete="off">
                </td>
            </tr>
            <tr>
                <td>
                    <?echo $langs->trans('GPS')?>
                </td>
                <td>
                    <input id="GPS" class="ui-autocomplete-input" type="text" autofocus="autofocus" value="<?echo $soc_address->GPS?>" name="GPS" maxlength="20" size="60" autocomplete="off">
                </td>
            </tr>
            <tr>
                <td>
                <!--<td class="<?if($action == 'error' && (empty($soc_address->e_mail) || !isValidEMail($soc_address->e_mail))){echo 'fielderror';}else{echo 'fieldrequired';}?>">-->
                    <?echo $langs->trans('e-mail')?>
                </td>
                <td>
                    <input id="e_mail" class="ui-autocomplete-input" type="text" autofocus="autofocus" value="<?echo $soc_address->e_mail?>" name="e_mail" maxlength="20" size="60" autocomplete="off">
                </td>
            </tr>
            <tr>
                <td>
                    <?echo $langs->trans('site')?>
                </td>
                <td>
                    <input id="site" class="ui-autocomplete-input" type="text" autofocus="autofocus" value="<?echo $soc_address->site?>" name="site" maxlength="50" size="60" autocomplete="off">
                </td>
            </tr>
            <tr>
                <td>
                    <?echo $langs->trans('WorkerCount')?>
                </td>
                <td>
                    <input id="WorkerCount" class="param" type="text" autofocus="autofocus" value="<?echo $soc_address->WorkerCount?>" name="WorkerCount" maxlength="6" size="60" autocomplete="off">
                </td>
            </tr>
            <tr>
                <td>
                    <?echo $langs->trans('SendPost')?>
                </td>
                <td>
                    <img id="imgSendPost" onclick="change_switchPost();" src="<?if($soc_address->SendPost == 1 || (empty($soc_address->SendPost)&&$soc_address->SendPost!=0) || $action == 'add') echo '/dolibarr/htdocs/theme/eldy/img/switch_on.png'; else echo '/dolibarr/htdocs/theme/eldy/img/switch_off.png'; ?>">
                </td>
            </tr>
            <tr>
                <td>
                    <?echo $langs->trans('SendEmail')?>
                </td>
                <td >
                    <img id="imgSendEmail"  onclick="change_switchEmail();" src="<?if($soc_address->SendEmail == 1 || (empty($soc_address->SendEmail)&&$soc_address->SendEmail!=0) || $action == 'add') echo '/dolibarr/htdocs/theme/eldy/img/switch_on.png'; else echo '/dolibarr/htdocs/theme/eldy/img/switch_off.png'; ?>">
                </td>
            </tr>
        </table>
        <div align="center">
        <button onclick="save();">Зберегти</button>
            <button onclick="back();">Відмінити</button>
        </div>
    </form>

</div>
<script type="text/javascript">
    function back(){
        $('#action').val('cancel');
        $('#addaddress').attr('action', $('#url').val());
    }
    function save(){
        $('#action').val('save');
    }
    function change_switchPost(){
        if($('#SendPost').val() == 0){
            $('#SendPost').val(1);
            $('#imgSendPost').attr('src',"/dolibarr/htdocs/theme/eldy/img/switch_on.png");
        }else{
            $('#SendPost').val(0);
            $('#imgSendPost').attr('src',"/dolibarr/htdocs/theme/eldy/img/switch_off.png");
        }
    }    
    function change_switchEmail(){
        if($('#SendEmail').val() == 0){
            $('#SendEmail').val(1);
            $('#imgSendEmail').attr('src',"/dolibarr/htdocs/theme/eldy/img/switch_on.png");
        }else{
            $('#SendEmail').val(0);
            $('#imgSendEmail').attr('src',"/dolibarr/htdocs/theme/eldy/img/switch_off.png");
        }
    }
    $(".param").keypress(function( b ){        var C = /[0-9\x25\x27\x24\x23]/;        var a = b.which;        var c = String.fromCharCode(a);        return !!(a==0||a==8||a==9||a==13||c.match(C));    });
</script>
<script>
    var townlist = [];
    $("#location").autocomplete({
        //Определяем обратный вызов к результатам форматирования

        source: function(req, add){
            req["tablename"]="llx_c_ziptown";
            req["fieldname"]="nametown";
            //Передаём запрос на сервер
            $.getJSON("autocomplete.php?callback=?", req, function(data) {
                if(data == null){
                    $("#location").val(req["term"]);
                    //                    console.log($("#name").val());
                    add(null);
                    return;
                }
                //Создаем массив для объектов ответа
                var suggestions = [];
                //Обрабатываем ответ
                $.each(data, function(i, val){
                    townlist.push({"rowid":val.rowid, "name":val.name});
                    suggestions.push(val.name);

                });

                //Передаем массив обратному вызову
                add(suggestions);

            });
        },

        //Определяем обработчик селектора
        select: function(e, ui) {
            $("#location").value = ui.item.value;
            for(var i = 0; i<townlist.length; i++){
                if(townlist[i].name == ui.item.value){
                    $("#townid").val(townlist[i].rowid);
                    console.log($("#townid").val());
                    break;
                }
            }

//                        //Создаем форматированную переменную cust_name
//                        var cust_name = ui.item.value,
//                                        span = $("<span>").text(cust_name),
//                                        a = $("<a>").addClass("remove").attr({
//                                            href: "javascript:",
//                                            title: "Remove " + cust_name
//                                        }).text("x").appendTo(span);
//
//                                    //Добавляем cust_name к div cust_name
//                                    span.insertBefore("#name");
        },

        //Определяем обработчик выбора
        change: function() {
            //Сохраняем поле "Наименование" без изменений и в правильной позиции
//                        $("#name").val("").css("top", 2);
        }
    });
</script>
