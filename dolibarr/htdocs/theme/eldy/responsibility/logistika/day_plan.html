<div style=" width:100%; height:1px; clear:both;">.</div>
<div style="float: left">
    <div id = "lefttable">
        <table id="headercontrol" >
            <tr id="today">
                <td>
                    <?=$langs->trans('TitleToday')?>
                </td>
                <td class="autoinsert">
                    <?=date('d.m.Y')?>
                </td>
            </tr>
            <tr id="worker">
                <td>
                    <?=$langs->trans('worker')?>
                </td>
                <td class="autoinsert">
                    <?echo $user->lastname?>
                </td>
            </tr>
        </table>
        </br>
    </div>
    <button onclick="RefreshData();">Оновити дані</button>

    <div>
        <table class="WidthScroll">
            <thead>
                <tr class="multiple_header_table">
                    <th rowspan="4" style="width: 105px;">Область</th>
                    <th rowspan="4" style="width: 175px;">Район</th>
                    <th rowspan="4" style="width: 33px;">&nbsp;</th>
                    <th colspan="9">% виконання запланованого по факту</th>
                    <th colspan="9">минуле (факт)</th>
                    <th rowspan="4" class="small_size" style="width: 50px;writing-mode:tb-lr;">кільк. простроч.</th>
                    <th colspan="9">майбутнє (план)</th>
                </tr>
                <tr class="multiple_header_table">
                    <!--% виконання запланованого по факту-->
                    <th class="small_size" style="width: 35px">за місяць</th>
                    <th class="small_size" style="width: 30px">за 7 днів</th>
                    <th class="small_size" style="width: 30px">за 6 днів</th>
                    <th class="small_size" style="width: 30px">за 5 днів</th>
                    <th class="small_size" style="width: 30px">за 4 днів</th>
                    <th class="small_size" style="width: 30px">за 3 дня</th>
                    <th class="small_size" style="width: 30px">за 2 дня</th>
                    <th class="small_size" style="width: 30px">за 1 день</th>
                    <th class="small_size" style="width: 35px">сього- дні</th>
                    <!--минуле (факт)-->
                    <th class="small_size" style="width: 35px">за місяць</th>
                    <th class="small_size" style="width: 30px">за 7 днів</th>
                    <th class="small_size" style="width: 30px">за 6 днів</th>
                    <th class="small_size" style="width: 30px">за 5 днів</th>
                    <th class="small_size" style="width: 30px">за 4 днів</th>
                    <th class="small_size" style="width: 30px">за 3 дня</th>
                    <th class="small_size" style="width: 30px">за 2 дня</th>
                    <th class="small_size" style="width: 30px">за 1 день</th>
                    <th class="small_size" style="width: 35px">сього- дні</th>
                    <!--майбутнє (план)-->
                    <th class="small_size" style="width: 35px">сього- дні</th>
                    <th class="small_size" style="width: 30px">за 1 день</th>
                    <th class="small_size" style="width: 30px">за 2 дня</th>
                    <th class="small_size" style="width: 30px">за 3 дня</th>
                    <th class="small_size" style="width: 30px">за 4 днів</th>
                    <th class="small_size" style="width: 30px">за 5 днів</th>
                    <th class="small_size" style="width: 30px">за 6 днів</th>
                    <th class="small_size" style="width: 30px">за 7 днів</th>
                    <th class="small_size" style="width: 35px">за місяць</th>
                </tr>
                <tr class="multiple_header_table">
                    <!--% виконання запланованого по факту-->
                    <th class="small_size"></th>
                    <th class="small_size"></th>
                    <th class="small_size"><?=$langs->trans('ShortDay'.date('w', mktime(0,0,0, date('m'), date('d')-6, date('Y'))))?></th>
                    <th class="small_size"><?=$langs->trans('ShortDay'.date('w', mktime(0,0,0, date('m'), date('d')-5, date('Y'))))?></th>
                    <th class="small_size"><?=$langs->trans('ShortDay'.date('w', mktime(0,0,0, date('m'), date('d')-4, date('Y'))))?></th>
                    <th class="small_size"><?=$langs->trans('ShortDay'.date('w', mktime(0,0,0, date('m'), date('d')-3, date('Y'))))?></th>
                    <th class="small_size"><?=$langs->trans('ShortDay'.date('w', mktime(0,0,0, date('m'), date('d')-2, date('Y'))))?></th>
                    <th class="small_size"><?=$langs->trans('ShortDay'.date('w', mktime(0,0,0, date('m'), date('d')-1, date('Y'))))?></th>
                    <th class="small_size"><?=$langs->trans('ShortDay'.date('w'))?></th>
                    <!--минуле (факт)-->
                    <th class="small_size"></th>
                    <th class="small_size"></th>
                    <th class="small_size"><?=$langs->trans('ShortDay'.date('w', mktime(0,0,0, date('m'), date('d')-6, date('Y'))))?></th>
                    <th class="small_size"><?=$langs->trans('ShortDay'.date('w', mktime(0,0,0, date('m'), date('d')-5, date('Y'))))?></th>
                    <th class="small_size"><?=$langs->trans('ShortDay'.date('w', mktime(0,0,0, date('m'), date('d')-4, date('Y'))))?></th>
                    <th class="small_size"><?=$langs->trans('ShortDay'.date('w', mktime(0,0,0, date('m'), date('d')-3, date('Y'))))?></th>
                    <th class="small_size"><?=$langs->trans('ShortDay'.date('w', mktime(0,0,0, date('m'), date('d')-2, date('Y'))))?></th>
                    <th class="small_size"><?=$langs->trans('ShortDay'.date('w', mktime(0,0,0, date('m'), date('d')-1, date('Y'))))?></th>
                    <th class="small_size"><?=$langs->trans('ShortDay'.date('w'))?></th>
                    <!--майбутнє (план)-->
                    <th class="small_size"><?=$langs->trans('ShortDay'.date('w'))?></th>
                    <th class="small_size"><?=$langs->trans('ShortDay'.date('w', mktime(0,0,0, date('m'), date('d')+1, date('Y'))))?></th>
                    <th class="small_size"><?=$langs->trans('ShortDay'.date('w', mktime(0,0,0, date('m'), date('d')+2, date('Y'))))?></th>
                    <th class="small_size"><?=$langs->trans('ShortDay'.date('w', mktime(0,0,0, date('m'), date('d')+3, date('Y'))))?></th>
                    <th class="small_size"><?=$langs->trans('ShortDay'.date('w', mktime(0,0,0, date('m'), date('d')+4, date('Y'))))?></th>
                    <th class="small_size"><?=$langs->trans('ShortDay'.date('w', mktime(0,0,0, date('m'), date('d')+5, date('Y'))))?></th>
                    <th class="small_size"><?=$langs->trans('ShortDay'.date('w', mktime(0,0,0, date('m'), date('d')+6, date('Y'))))?></th>
                    <th class="small_size"></th>
                    <th class="small_size"></th>
                </tr>
                <tr class="multiple_header_table">
                    <!--% виконання запланованого по факту-->
                    <th class="small_size"></th>
                    <th class="small_size"></th>
                    <th class="small_size"><?=date('d.m', (time()+3600*24*-6))?></th>
                    <th class="small_size"><?=date('d.m', (time()+3600*24*-5))?></th>
                    <th class="small_size"><?=date('d.m', (time()+3600*24*-4))?></th>
                    <th class="small_size"><?=date('d.m', (time()+3600*24*-3))?></th>
                    <th class="small_size"><?=date('d.m', (time()+3600*24*-2))?></th>
                    <th class="small_size"><?=date('d.m', (time()+3600*24*-1))?></th>
                    <th class="small_size"><?=date('d.m')?></th>
                    <!--минуле (факт)-->
                    <th class="small_size"></th>
                    <th class="small_size"></th>
                    <th class="small_size"><?=date('d.m', (time()+3600*24*-6))?></th>
                    <th class="small_size"><?=date('d.m', (time()+3600*24*-5))?></th>
                    <th class="small_size"><?=date('d.m', (time()+3600*24*-4))?></th>
                    <th class="small_size"><?=date('d.m', (time()+3600*24*-3))?></th>
                    <th class="small_size"><?=date('d.m', (time()+3600*24*-2))?></th>
                    <th class="small_size"><?=date('d.m', (time()+3600*24*-1))?></th>
                    <th class="small_size"><?=date('d.m')?></th>
                    <!--майбутнє (план)-->
                    <th class="small_size"><?=date('d.m')?></th>
                    <th class="small_size"><?=date('d.m', (time()+3600*24*1))?></th>
                    <th class="small_size"><?=date('d.m', (time()+3600*24*2))?></th>
                    <th class="small_size"><?=date('d.m', (time()+3600*24*3))?></th>
                    <th class="small_size"><?=date('d.m', (time()+3600*24*4))?></th>
                    <th class="small_size"><?=date('d.m', (time()+3600*24*5))?></th>
                    <th class="small_size"><?=date('d.m', (time()+3600*24*6))?></th>
                    <th class="small_size"></th>
                    <th class="small_size"></th>
                </tr>
            </thead>

            <?=$table?>

        </table>
    </div>

</div>

<script>
    $(document).ready(function(){
        $('#reference_body').attr('height', window.innerHeight - 370);
        $('#reference_body').width($('#reference_body').width()+15);
        $('#popupmenu').offset({top:550, left:-250});
        var Width = $(".WidthScroll").width();
        var Top = $(".WidthScroll").height();
        $("#sent_task").offset({top:Top+180, left:-Width+5});
    })
    function RefreshData(){
        <?unset($_SESSION['actions']);?>
        location.href=location.href;
    }
    function RegionsByLineActive(id_usr, cat_id){
        var btn = document.getElementById('btnLineActive'+cat_id);
        var tr_item = btn.parentNode.parentNode;
         var img = document.getElementById('imgLineActive'+cat_id);
//        console.log($('#btnLineActive'+cat_id).find('img').attr('src') == '/dolibarr/htdocs/theme/eldy/img/1downarrow.png');
        var show = img.src.substr(img.src.length-('1downarrow.png').length) == '1downarrow.png';
        if(show)
            img.src = img.src.substr(0, img.src.length-('1downarrow.png').length)+'1uparrow.png';
        else
            img.src = img.src.substr(0, img.src.length-('1uparrow.png').length)+'1downarrow.png';
        if(show){
            if($('.category'+cat_id).length == 0){
                var param = {
                    id_usr:id_usr,
                    cat_id:cat_id,
                    action:'getActionsByRegions'
                }
                $.ajax({
                    url:'',
                    data:param,
                    cache:false,
                    success:function(html){

                        tr_item.insertAdjacentHTML('afterend', html);
                    }
                })
            }else{
                $('.category'+cat_id).show();
            }
        }else{
            $('.category'+cat_id).hide();
        }
    }
//    }
    function setdate(id){
//        console.log($('#'+id).text());
//        console.log($("#popupmenu").attr('type_action').substr(0, 'current'.length));
        location.href = 'http://'+location.hostname+'/dolibarr/htdocs/hourly_plan.php?idmenu=10420&mainmenu=hourly_plan&leftmenu=&date='+$('#'+id).text();
//        $("#popupmenu").hide();
    }
</script>
